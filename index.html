<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VetCare Pro</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
    :root { --p: #3498db; --s: #2ecc71; --d: #e74c3c; }
    body { background: #f5f7fa; font-size: 14px; }
    .container-main { width: 100%; max-width: 1200px; margin: 0 auto; padding: 10px; }
    .header { background: linear-gradient(135deg, var(--p), #2980b9); color: #fff; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
    .control-bar { background: #fff; padding: 15px; border-radius: 10px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between; }
    .citas-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-top: 15px; }
    
    @media (max-width: 350px) {
        .citas-container { grid-template-columns: 1fr; }
        .header h1 { font-size: 1.2rem; }
    }

    .cita-card { background: #fff; border-radius: 10px; padding: 15px; border-left: 5px solid var(--p); position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .badge-est { padding: 3px 8px; border-radius: 10px; font-size: 11px; text-transform: uppercase; font-weight: 700; }
    .est-abierta { background: #e8f8f0; color: #27ae60; }
    .est-terminada { background: #fef5e7; color: #f39c12; }
    .est-anulada { background: #fdedec; color: var(--d); }
    .gif-thumb { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; border: 1px solid #eee; }

    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; padding: 10px; }
    .modal-content { background: #fff; width: 100%; max-width: 450px; border-radius: 12px; overflow: hidden; }
    
    .is-invalid { border: 2px solid var(--d) !important; }
    .err-txt { 
        color: var(--d); 
        font-size: 12px; 
        display: none; 
        background: #fdedec; 
        padding: 8px; 
        border-radius: 5px; 
        border: 1px solid var(--d);
    }
</style>
</head>
<body>

<div class="container-main">
    <div class="header text-center"><h1 class="m-0"><i class="bi bi-patch-check"></i> VetCare Pro</h1></div>
    <div class="control-bar">
        <select id="fEstado" onchange="render()" class="form-select form-select-sm w-auto">
            <option value="Todas">Todos los estados</option>
            <option value="Abierta">Abiertas</option>
            <option value="Terminada">Terminadas</option>
            <option value="Anulada">Anuladas</option>
        </select>
        <button class="btn btn-success btn-sm px-3" onclick="openM('add')"><i class="bi bi-plus-lg"></i> NUEVA CITA</button>
    </div>
    <div id="box" class="citas-container"></div>
</div>

<div id="m" class="modal">
    <div class="modal-content">
        <div class="p-3 bg-primary text-white d-flex justify-content-between">
            <span id="mT">Cita</span>
            <button class="btn-close btn-close-white" onclick="closeM()"></button>
        </div>
        <form id="f" class="p-3" novalidate>
            <div class="row g-2">
                <div class="col-12"><div id="msgErr" class="err-txt text-center fw-bold mb-2"></div></div>

                <div class="col-6">
                    <label class="small fw-bold">Animal</label>
                    <select id="tipoAnimal" class="form-select form-select-sm">
                        <option value="">Seleccione...</option>
                        <option value="Ave">Ave</option>
                        <option value="Cabra">Cabra</option>
                        <option value="Cerdo">Cerdo</option>
                        <option value="Conejo">Conejo</option>
                        <option value="Gato">Gato</option>
                        <option value="Hamster">Hamster</option>
                        <option value="Huron">Huron</option>
                        <option value="Pato">Pato</option>
                        <option value="Perro">Perro</option>
                        <option value="Tortuga">Tortuga</option>
                    </select>
                </div>
                <div class="col-6">
                    <label class="small fw-bold">Mascota</label>
                    <input id="mascota" class="form-control form-select-sm" placeholder="Nombre">
                </div>
                <div class="col-12">
                    <label class="small fw-bold">Propietario / Tel</label>
                    <div class="input-group">
                        <input id="propietario" class="form-control form-control-sm" placeholder="Nombre">
                        <input id="telefono" class="form-control form-control-sm" placeholder="Tel">
                    </div>
                </div>
                <div class="col-6">
                    <label class="small fw-bold">Fecha</label>
                    <input type="date" id="fecha" class="form-control form-control-sm">
                </div>
                <div class="col-6">
                    <label class="small fw-bold">Hora (8am-8pm)</label>
                    <input type="time" id="hora" class="form-control form-control-sm">
                </div>
                <div class="col-12">
                    <label class="small fw-bold">Síntomas</label>
                    <textarea id="sintomas" class="form-control form-control-sm" rows="2"></textarea>
                </div>
                <div id="eC" class="col-12 d-none">
                    <label class="small fw-bold">Estado</label>
                    <select id="estado" class="form-select form-select-sm">
                        <option value="Abierta">Abierta</option>
                        <option value="Terminada">Terminada</option>
                        <option value="Anulada">Anulada</option>
                    </select>
                </div>
            </div>
            <div class="mt-3 d-flex gap-2">
                <button type="button" class="btn btn-secondary btn-sm w-100" onclick="closeM()">CANCELAR</button>
                <button type="submit" class="btn btn-primary btn-sm w-100">GUARDAR</button>
            </div>
        </form>
    </div>
</div>

<script>
const G = { 'Perro': 'https://media.tenor.com/8JbA6zMxJ5cAAAAi/dog-pet.gif', 'Gato': 'https://media.tenor.com/z_4d6PCweikAAAAi/cat-pet.gif', 'Ave': 'https://media.tenor.com/6JcUdwizNHgAAAAi/bird-flying.gif', 'Conejo': 'https://media.tenor.com/9C_DNIm0qF0AAAAi/rabbit-bunny.gif', 'Hámster': 'https://media.tenor.com/RhZwQ2tXXIIAAAAi/hamster-rodent.gif' };

let citas = JSON.parse(localStorage.getItem('citas')) || [];
let eId = null;
const $ = id => document.getElementById(id);

function setMinDate() {
    const today = new Date();
    today.setDate(today.getDate() + 1); 
    $('fecha').min = today.toISOString().split('T')[0];
}

function openM(mode, id = null) {
    eId = id;
    $('f').reset();
    $('msgErr').style.display = 'none';
    $('f').querySelectorAll('.is-invalid').forEach(i => i.classList.remove('is-invalid'));
    $('eC').classList.toggle('d-none', mode === 'add');
    $('mT').innerText = mode === 'add' ? 'Nueva Cita' : 'Editar Cita';
    setMinDate();
    if(id) {
        const c = citas.find(x => x.id === id);
        Object.keys(c).forEach(k => { if($(k)) $(k).value = c[k] });
    }
    $('m').style.display = 'flex';
}

function closeM() { $('m').style.display = 'none'; eId = null; }

$('f').onsubmit = (e) => {
    e.preventDefault();
    
    const etiquetas = {
        tipoAnimal: "el tipo de animal",
        mascota: "el nombre de la mascota",
        propietario: "el nombre del propietario",
        telefono: "el teléfono",
        fecha: "la fecha (mínimo mañana)",
        hora: "la hora de la cita",
        sintomas: "los síntomas"
    };

    let mensajeError = "";
    let primerCampoError = null;

    for (let id in etiquetas) {
        if (!$(id).value.trim()) {
            $(id).classList.add('is-invalid');
            if (!primerCampoError) {
                mensajeError = `Por favor, llena el campo de ${etiquetas[id]}`;
                primerCampoError = $(id);
            }
        } else {
            $(id).classList.remove('is-invalid');
        }
    }

    if (!primerCampoError) {
        const hVal = $('hora').value;
        if (hVal < "08:00" || hVal > "20:00") {
            $('hora').classList.add('is-invalid');
            mensajeError = "La hora debe estar entre las 8:00 AM y las 8:00 PM";
            primerCampoError = $('hora');
        }
    }

    if (mensajeError) {
        $('msgErr').innerText = mensajeError;
        $('msgErr').style.display = 'block';
        return;
    }

    const d = {
        id: eId || Date.now(),
        tipoAnimal: $('tipoAnimal').value,
        mascota: $('mascota').value,
        propietario: $('propietario').value,
        telefono: $('telefono').value,
        fecha: $('fecha').value,
        hora: $('hora').value,
        sintomas: $('sintomas').value,
        estado: eId ? $('estado').value : "Abierta"
    };
    
    citas = eId ? citas.map(c => c.id === eId ? d : c) : [...citas, d];
    localStorage.setItem('citas', JSON.stringify(citas));
    render(); closeM();
};

function del(id) { if(confirm('¿Eliminar?')) { citas = citas.filter(c => c.id !== id); localStorage.setItem('citas', JSON.stringify(citas)); render(); } }

function render() {
    const f = $('fEstado').value;
    const filtered = citas.filter(c => f === "Todas" || c.estado === f);
    $('box').innerHTML = filtered.map(c => `
        <div class="cita-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <img src="${G[c.tipoAnimal]}" class="gif-thumb">
                <span class="badge-est est-${c.estado.toLowerCase()}">${c.estado}</span>
            </div>
            <h6 class="mb-1 text-primary">${c.mascota} <small class="text-muted">(${c.tipoAnimal})</small></h6>
            <div class="small text-secondary">
                <p class="m-0"><i class="bi bi-person"></i> ${c.propietario}</p>
                <p class="m-0"><i class="bi bi-calendar"></i> ${c.fecha} | ${c.hora}</p>
            </div>
            <div class="bg-light p-2 my-2 rounded-2 small">${c.sintomas}</div>
            <div class="d-flex gap-1">
                <button class="btn btn-outline-primary btn-sm w-100" onclick="openM('edit', ${c.id})">EDITAR</button>
                <button class="btn btn-outline-danger btn-sm px-3" onclick="del(${c.id})"><i class="bi bi-trash"></i></button>
            </div>
        </div>
    `).join('');
}

document.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>
